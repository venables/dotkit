# dotkit

A powerful CLI toolkit for managing environment variables and dotenv files.

## Features

- **Sync** environment variables from template files (like `.env.example`) to your `.env` files
- **Generate** random hex values for secrets and authentication tokens
- **Smart filtering** with `--only` to sync specific variables
- **Flexible generation** modes to mix template copying with random value generation
- **Force overwrite** existing values with `-f/--force` when generating
- **Safe by default** - won't overwrite existing values unless forced
- **Dry-run support** to preview changes before applying them
- **Bootstrap mode** to create new `.env` files from templates

## Installation

```bash
npm install -g dotkit
```

## Usage

### Sync Command

Sync environment variables from a template file to your `.env` file:

```bash
# Basic sync from .env.example to .env
dotkit sync

# Sync with custom paths
dotkit sync --source .env.local.example --target .env.local

# Sync only specific variables
dotkit sync --only API_KEY DB_URL

# Just sync from template (no generation)
dotkit sync

# Preview changes without modifying files
dotkit sync --dry-run
```

### Generate Command

Generate random hex values for environment variables:

```bash
# Generate random values for multiple variables
dotkit generate AUTH_SECRET JWT_SECRET SESSION_KEY

# Generate to a specific file
dotkit generate AUTH_SECRET --target .env.local

# Preview what would be generated
dotkit generate AUTH_SECRET --dry-run

# Force overwrite existing values
dotkit generate AUTH_SECRET --force

# Use short flags
dotkit generate AUTH_SECRET -t .env.local -f
```

## Options

### Sync Command Options

- `-t, --target <path>` - Target .env file (default: `.env`)
- `-s, --source <path>` - Source template file (default: `.env.example`)
- `--only <variables...>` - Only sync these specific variables
- `--dry-run` - Show what would be copied without making changes

### Generate Command Options

- `-t, --target <path>` - Target .env file (default: `.env`)
- `-f, --force` - Overwrite existing values (default: skip existing)
- `--dry-run` - Show what would be generated without making changes

## Examples

### Basic Workflow

1. **Create a template file** (`.env.example`):

```env
API_KEY=your_api_key_here
DB_URL=postgres://localhost:5432/myapp
AUTH_SECRET=replace_with_random_value
JWT_SECRET=replace_with_random_value
```

2. **Bootstrap your .env file**:

```bash
# First sync template values
dotkit sync

# Then generate secrets separately
dotkit generate AUTH_SECRET JWT_SECRET
```

This creates `.env` with:

```env
API_KEY=your_api_key_here
DB_URL=postgres://localhost:5432/myapp
AUTH_SECRET=replace_with_random_value
JWT_SECRET=replace_with_random_value

# Generated by dotkit
AUTH_SECRET=a1b2c3d4e5f6789...  # 64-character random hex
JWT_SECRET=9f8e7d6c5b4a321...   # 64-character random hex
```

### Adding New Variables

Add new variables to your `.env.example`:

```env
API_KEY=your_api_key_here
DB_URL=postgres://localhost:5432/myapp
AUTH_SECRET=replace_with_random_value
JWT_SECRET=replace_with_random_value
NEW_FEATURE_FLAG=false
```

Sync only the new variable:

```bash
dotkit sync --only NEW_FEATURE_FLAG
```

### Generating Additional Secrets

Generate new secrets directly:

```bash
dotkit generate SESSION_SECRET CSRF_TOKEN
```

### Force Overwriting Existing Values

By default, `dotkit generate` skips variables that already exist:

```bash
# .env already contains AUTH_SECRET=old_value
dotkit generate AUTH_SECRET NEW_SECRET
# Result: Skips AUTH_SECRET, only generates NEW_SECRET
# Output: "Already exist (skipped): AUTH_SECRET"
```

Use `--force` to overwrite existing values:

```bash
dotkit generate AUTH_SECRET NEW_SECRET --force
# Result: Overwrites AUTH_SECRET with new random value, generates NEW_SECRET
```

## How It Works

### Bootstrap Mode

When your `.env` file doesn't exist, `dotkit sync` creates it from your template file. You can filter which variables to include with `--only`.

### Sync Mode

When your `.env` file exists, `dotkit sync` appends any missing variables from the template. Existing variables in your `.env` file are never modified.

### Generate Mode

`dotkit generate` creates random hex values for specified variables. It works independently of templates and can create new files or append to existing ones.

By default, it **skips variables that already exist** in the target file. Use `-f` or `--force` to overwrite existing values.

### Random Value Generation

Generated values are 64-character hexadecimal strings created using Node.js `crypto.randomBytes()` for cryptographic security.

## Architecture

The toolkit is built with a modular architecture:

- **`src/lib/common.ts`** - Shared utilities and types
- **`src/lib/sync.ts`** - Sync command logic and template processing
- **`src/lib/generate.ts`** - Generate command logic for random values
- **Entry point** handles CLI parsing and command routing

## Development

```bash
# Install dependencies
pnpm install

# Run tests
pnpm test

# Build
pnpm build

# Run all checks (format, lint, typecheck)
pnpm check

# Auto-fix issues
pnpm fix
```

## License

MIT
